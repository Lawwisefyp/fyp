<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Search Lawyers - LawWise</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .search-section {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .search-form {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            align-items: end;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
        }
        
        label {
            margin-bottom: 5px;
            font-weight: bold;
            color: #333;
        }
        
        input, select {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }
        
        .btn {
            background-color: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .btn:hover {
            background-color: #0056b3;
        }
        
        .results-section {
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .results-header {
            background-color: #007bff;
            color: white;
            padding: 15px 20px;
        }
        
        .lawyer-card {
            border-bottom: 1px solid #eee;
            padding: 20px;
            display: flex;
            gap: 20px;
        }
        
        .lawyer-card:last-child {
            border-bottom: none;
        }
        
        .lawyer-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background-color: #ddd;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: #666;
            flex-shrink: 0;
        }
        
        .lawyer-info {
            flex: 1;
        }
        
        .lawyer-name {
            font-size: 20px;
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }
        
        .lawyer-title {
            color: #666;
            margin-bottom: 5px;
        }
        
        .lawyer-location {
            color: #888;
            margin-bottom: 10px;
        }
        
        .practice-areas {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-bottom: 10px;
        }
        
        .practice-area {
            background-color: #e7f3ff;
            color: #007bff;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 12px;
        }
        
        .lawyer-stats {
            display: flex;
            gap: 20px;
            margin-bottom: 10px;
            font-size: 14px;
            color: #666;
        }
        
        .lawyer-bio {
            color: #555;
            font-size: 14px;
            line-height: 1.4;
        }
        
        .lawyer-actions {
            display: flex;
            flex-direction: column;
            gap: 10px;
            align-items: flex-end;
        }
        
        .rate {
            font-size: 18px;
            font-weight: bold;
            color: #28a745;
        }
        
        .btn-contact {
            background-color: #28a745;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .btn-contact:hover {
            background-color: #218838;
        }
        
        .pagination {
            display: flex;
            justify-content: center;
            margin-top: 20px;
            gap: 5px;
        }
        
        .page-btn {
            padding: 8px 12px;
            border: 1px solid #ddd;
            background: white;
            cursor: pointer;
            border-radius: 3px;
        }
        
        .page-btn.active {
            background-color: #007bff;
            color: white;
            border-color: #007bff;
        }
        
        .no-results {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Find the Right Lawyer</h1>
        
        <!-- Search Form -->
        <div class="search-section">
            <form id="searchForm" class="search-form">
                <div class="form-group">
                    <label for="query">Search</label>
                    <input type="text" id="query" name="query" placeholder="Lawyer name, specialization...">
                </div>
                
                <div class="form-group">
                    <label for="practiceArea">Practice Area</label>
                    <select id="practiceArea" name="practiceArea">
                        <option value="">All Areas</option>
                        <option value="Criminal Law">Criminal Law</option>
                        <option value="Family Law">Family Law</option>
                        <option value="Corporate Law">Corporate Law</option>
                        <option value="Civil Law">Civil Law</option>
                        <option value="Immigration Law">Immigration Law</option>
                        <option value="Tax Law">Tax Law</option>
                        <option value="Property Law">Property Law</option>
                        <option value="Labor Law">Labor Law</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="city">City</label>
                    <input type="text" id="city" name="city" placeholder="Enter city">
                </div>
                
                <div class="form-group">
                    <label for="minExperience">Min Experience</label>
                    <select id="minExperience" name="minExperience">
                        <option value="">Any</option>
                        <option value="1">1+ years</option>
                        <option value="3">3+ years</option>
                        <option value="5">5+ years</option>
                        <option value="10">10+ years</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="maxRate">Max Rate (PKR/hour)</label>
                    <input type="number" id="maxRate" name="maxRate" placeholder="Max hourly rate">
                </div>
                
                <div class="form-group">
                    <label for="isAvailable">Availability</label>
                    <select id="isAvailable" name="isAvailable">
                        <option value="">All</option>
                        <option value="true">Available Now</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <button type="submit" class="btn">Search Lawyers</button>
                </div>
            </form>
        </div>
        
        <!-- Results Section -->
        <div class="results-section">
            <div class="results-header">
                <h3 id="resultsTitle">Search Results</h3>
            </div>
            
            <div id="resultsContainer">
                <div class="loading">
                    Enter search criteria and click "Search Lawyers" to find lawyers.
                </div>
            </div>
            
            <div id="pagination" class="pagination" style="display: none;">
            </div>
        </div>
    </div>

    <script>
        let currentPage = 1;
        let currentSearchParams = {};

        // Handle search form submission
        document.getElementById('searchForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            currentPage = 1;
            await performSearch();
        });

        // Perform search
        async function performSearch() {
            const form = document.getElementById('searchForm');
            const formData = new FormData(form);
            const params = new URLSearchParams();
            
            // Build search parameters
            for (let [key, value] of formData.entries()) {
                if (value.trim()) {
                    params.append(key, value);
                }
            }
            
            params.append('page', currentPage);
            params.append('limit', 10);
            
            currentSearchParams = Object.fromEntries(params);
            
            try {
                showLoading();
                
                const response = await fetch(`/api/lawyer/search?${params}`);
                const result = await response.json();
                
                if (result.success) {
                    displayResults(result.lawyers, result.pagination);
                } else {
                    showError('Error searching lawyers: ' + result.message);
                }
            } catch (error) {
                console.error('Search error:', error);
                showError('Error searching lawyers. Please try again.');
            }
        }

        // Display search results
        function displayResults(lawyers, pagination) {
            const container = document.getElementById('resultsContainer');
            const title = document.getElementById('resultsTitle');
            
            if (lawyers.length === 0) {
                container.innerHTML = '<div class="no-results">No lawyers found matching your criteria.</div>';
                title.textContent = 'No Results Found';
                document.getElementById('pagination').style.display = 'none';
                return;
            }
            
            title.textContent = `Found ${pagination.totalResults} lawyer(s)`;
            
            container.innerHTML = lawyers.map(lawyer => `
                <div class="lawyer-card">
                    <div class="lawyer-avatar">
                        ${lawyer.personalInfo.profilePicture ? 
                            `<img src="/${lawyer.personalInfo.profilePicture}" alt="Profile" style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover;">` :
                            `${lawyer.personalInfo.firstName.charAt(0)}${lawyer.personalInfo.lastName.charAt(0)}`
                        }
                    </div>
                    
                    <div class="lawyer-info">
                        <div class="lawyer-name">
                            ${lawyer.personalInfo.firstName} ${lawyer.personalInfo.lastName}
                        </div>
                        
                        <div class="lawyer-location">
                            📍 ${lawyer.personalInfo.city}${lawyer.personalInfo.state ? ', ' + lawyer.personalInfo.state : ''}
                        </div>
                        
                        <div class="practice-areas">
                            ${lawyer.professionalInfo.practiceAreas.map(area => 
                                `<span class="practice-area">${area}</span>`
                            ).join('')}
                        </div>
                        
                        <div class="lawyer-stats">
                            <span>⭐ ${lawyer.ratings.averageRating.toFixed(1)} (${lawyer.ratings.totalReviews} reviews)</span>
                            <span>💼 ${lawyer.professionalInfo.yearsOfExperience} years experience</span>
                            <span>🟢 ${lawyer.professionalInfo.isAvailable ? 'Available' : 'Busy'}</span>
                        </div>
                        
                        ${lawyer.personalInfo.bio ? 
                            `<div class="lawyer-bio">${lawyer.personalInfo.bio.substring(0, 150)}${lawyer.personalInfo.bio.length > 150 ? '...' : ''}</div>` : 
                            ''
                        }
                    </div>
                    
                    <div class="lawyer-actions">
                        ${lawyer.professionalInfo.hourlyRate ? 
                            `<div class="rate">PKR ${lawyer.professionalInfo.hourlyRate}/hr</div>` : 
                            '<div class="rate">Rate not specified</div>'
                        }
                        <button class="btn-contact" onclick="contactLawyer('${lawyer._id}')">Contact</button>
                        <button class="btn" onclick="viewProfile('${lawyer._id}')">View Profile</button>
                    </div>
                </div>
            `).join('');
            
            // Display pagination
            displayPagination(pagination);
        }

        // Display pagination
        function displayPagination(pagination) {
            const paginationContainer = document.getElementById('pagination');
            
            if (pagination.totalPages <= 1) {
                paginationContainer.style.display = 'none';
                return;
            }
            
            paginationContainer.style.display = 'flex';
            
            let paginationHTML = '';
            
            // Previous button
            if (pagination.currentPage > 1) {
                paginationHTML += `<button class="page-btn" onclick="goToPage(${pagination.currentPage - 1})">Previous</button>`;
            }
            
            // Page numbers
            const startPage = Math.max(1, pagination.currentPage - 2);
            const endPage = Math.min(pagination.totalPages, pagination.currentPage + 2);
            
            for (let i = startPage; i <= endPage; i++) {
                paginationHTML += `<button class="page-btn ${i === pagination.currentPage ? 'active' : ''}" onclick="goToPage(${i})">${i}</button>`;
            }
            
            // Next button
            if (pagination.hasNext) {
                paginationHTML += `<button class="page-btn" onclick="goToPage(${pagination.currentPage + 1})">Next</button>`;
            }
            
            paginationContainer.innerHTML = paginationHTML;
        }

        // Go to specific page
        async function goToPage(page) {
            currentPage = page;
            await performSearch();
        }

        // Show loading state
        function showLoading() {
            document.getElementById('resultsContainer').innerHTML = '<div class="loading">Searching lawyers...</div>';
            document.getElementById('pagination').style.display = 'none';
        }

        // Show error message
        function showError(message) {
            document.getElementById('resultsContainer').innerHTML = `<div class="no-results">${message}</div>`;
            document.getElementById('pagination').style.display = 'none';
        }

        // Contact lawyer function (you can implement this based on your needs)
        function contactLawyer(lawyerId) {
            // Implement contact functionality
            alert(`Contact lawyer with ID: ${lawyerId}`);
            // You could redirect to a contact form or open a modal
        }

        // View profile function
        function viewProfile(lawyerId) {
            // Implement view profile functionality
            window.location.href = `lawyer-details.html?id=${lawyerId}`;
        }

        // Perform initial search to show all available lawyers
        window.addEventListener('load', () => {
            performSearch();
        });
    </script>
</body>
</html>